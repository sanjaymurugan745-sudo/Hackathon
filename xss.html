<!DOCTYPE html>
<html>

<head>
    <title>XSS Challenge: Stealth Mode</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
            background-color: #f0f0f0;
        }
        
        #vulnerableElement {
            border: 1px solid #ccc;
            padding: 20px;
            margin-top: 30px;
            background-color: white;
        }
        
        .success {
            display: none;
            color: green;
            font-weight: bold;
            margin-top: 20px;
        }
    </style>
</head>

<body>
    <h1>Secret XSS Challenge</h1>
    <p>This page has a hidden vulnerability. Find and exploit it to reveal the flag in console.</p>

    <!-- Vulnerable element - reflects URL parameter -->
    <div id="vulnerableElement">
        Loading content...
    </div>

    <div id="successMessage" class="success">
        XSS Triggered! Check console for flag.
    </div>

    <script>
        (function() {
            // Hidden flag trigger mechanism
            window._xssFlag = false;
            const flag = "FLAG{github_xss_challenge}";

            // Extract and reflect URL parameters unsafely
            const urlParams = new URLSearchParams(window.location.search);
            const payload = urlParams.get('xss');

            // Vulnerable code - directly injects untrusted input into DOM
            if (payload) {
                document.getElementById('vulnerableElement').innerHTML =
                    `User input: ${payload}`;

                // Check for successful XSS pattern
                const patternCheck = /<script[\s\S]*?>[\s\S]*?alert\(1\)[\s\S]*?<\/script>/i;
                if (patternCheck.test(payload)) {
                    window._xssFlag = true;
                    document.getElementById('successMessage').style.display = 'block';
                    console.log(`%c[SUCCESS] Flag: ${flag}`,
                        'color: green; font-weight: bold; font-size: 14px');
                }
            }

            // Anti-debugging red herrings
            console.log("[DEBUG] Security checks initialized");
            console.warn("[WARNING] XSS protection enabled");
        })();
    </script>
</body>

</html>